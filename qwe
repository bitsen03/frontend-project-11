<html lang="ru"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Hexlet Frontend Project</title><script defer="defer" src="main.js"></script><link href="main.css" rel="stylesheet"></head><body class="d-flex flex-column min-vh-100"><div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="modal" aria-hidden="true"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title"></h5><button type="button" class="btn-close close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body text-break"></div><div class="modal-footer"><a class="btn btn-primary full-article" href="#" role="button" target="_blank" rel="noopener noreferrer">Читать полностью </a><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button></div></div></div></div><main class="flex-grow-1"><section class="container-fluid bg-dark p-5"><div class="row"><div class="col-md-10 col-lg-8 mx-auto text-white"><h1 class="display-3 mb-0">RSS агрегатор</h1><p class="lead">Начните читать RSS сегодня! Это легко, это красиво.</p><form action="" class="rss-form text-body"><div class="row"><div class="col"><div class="form-floating"><input id="url-input" autofocus="" required="" name="url" aria-label="url" class="form-control w-100 is-invalid" placeholder="ссылка RSS" autocomplete="off"> <label for="url-input">Ссылка RSS</label></div></div><div class="col-auto"><button type="submit" aria-label="add" class="h-100 btn btn-lg btn-primary px-sm-5">Добавить</button></div></div></form><p class="mt-2 mb-0 text-muted">Пример: https://ru.hexlet.io/lessons.rss</p><p class="feedback m-0 position-absolute small text-success text-danger">Ссылка должна быть валидным URL</p></div></div></section><section class="container-fluid container-xxl p-5"><div class="row"><div class="col-md-10 col-lg-8 order-1 mx-auto posts"><div class="card border-0">
      <div class="card-body"><h2 class="card-title h4">Посты</h2></div>
    <ul class="list-group border-0 rounded-0">
    <li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0">
    <a href="https://ru.hexlet.io/courses/java_streams/lessons/stream-rules/theory_unit" class="fw-bold" data-id="2" target="_blank" rel="noopener noreferrer">Как эффективно работать со стримами / Java: Стримы</a>
    <button type="button" class="btn btn-outline-primary btn-sm" data-id="2" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button>


    </li>
    <li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_streams/lessons/find/theory_unit" class="fw-bold" data-id="3" target="_blank" rel="noopener noreferrer">Поиск элементов (find) / Java: Стримы</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="3" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_streams/lessons/flat-map/theory_unit" class="fw-bold" data-id="4" target="_blank" rel="noopener noreferrer">Выравнивание данных (Flat Map) / Java: Стримы</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="4" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_streams/lessons/collectors/theory_unit" class="fw-bold" data-id="5" target="_blank" rel="noopener noreferrer">Стандартные методы свертки (Collectors) / Java: Стримы</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="5" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_streams/lessons/method-chain/theory_unit" class="fw-bold" data-id="6" target="_blank" rel="noopener noreferrer">Цепочка вызовов / Java: Стримы</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="6" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_streams/lessons/reduce/theory_unit" class="fw-bold" data-id="7" target="_blank" rel="noopener noreferrer">Свертка (reduce) / Java: Стримы</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="7" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_streams/lessons/filter/theory_unit" class="fw-bold" data-id="8" target="_blank" rel="noopener noreferrer">Фильтрация / Java: Стримы</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="8" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_streams/lessons/map/theory_unit" class="fw-bold" data-id="9" target="_blank" rel="noopener noreferrer">Отображение (map) / Java: Стримы</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="9" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_streams/lessons/declarative-programming/theory_unit" class="fw-bold" data-id="10" target="_blank" rel="noopener noreferrer">Декларативное программирование / Java: Стримы</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="10" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_streams/lessons/intro/theory_unit" class="fw-bold" data-id="11" target="_blank" rel="noopener noreferrer">Введение / Java: Стримы</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="11" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_generics/lessons/wildcard/theory_unit" class="fw-bold" data-id="12" target="_blank" rel="noopener noreferrer">Wildcard для спецификации подтипов / Java: Дженерики</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="12" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_generics/lessons/static-methods/theory_unit" class="fw-bold" data-id="13" target="_blank" rel="noopener noreferrer">Статические обобщенные методы / Java: Дженерики</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="13" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_generics/lessons/methods/theory_unit" class="fw-bold" data-id="14" target="_blank" rel="noopener noreferrer">Обобщенные методы / Java: Дженерики</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="14" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_generics/lessons/parametric-polymorphysm/theory_unit" class="fw-bold" data-id="15" target="_blank" rel="noopener noreferrer">Параметрический полиморфизм / Java: Дженерики</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="15" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_generics/lessons/classes/theory_unit" class="fw-bold" data-id="16" target="_blank" rel="noopener noreferrer">Реализация дженериков / Java: Дженерики</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="16" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_generics/lessons/examples/theory_unit" class="fw-bold" data-id="17" target="_blank" rel="noopener noreferrer">Примеры встроенных дженериков / Java: Дженерики</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="17" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_generics/lessons/how-it-works/theory_unit" class="fw-bold" data-id="18" target="_blank" rel="noopener noreferrer">Как работают дженирики / Java: Дженерики</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="18" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li><li class="list-group-item d-flex justify-content-between align-items-start border-0 border-end-0"><a href="https://ru.hexlet.io/courses/java_generics/lessons/intro/theory_unit" class="fw-bold" data-id="19" target="_blank" rel="noopener noreferrer">Введение в курс / Java: Дженерики</a><button type="button" class="btn btn-outline-primary btn-sm" data-id="19" data-bs-toggle="modal" data-bs-target="#modal">Просмотр</button></li></ul></div></div><div class="col-md-10 col-lg-4 mx-auto order-0 order-lg-1 feeds"><div class="card border-0">
      <div class="card-body"><h2 class="card-title h4">Фиды</h2>
      </div>
    <ul class="list-group border-0 rounded-0"><li class="list-group-item border-0 border-end-0"><h3 class="h6 m-0">Новые уроки на Хекслете</h3>
    <p class="m-0 small text-black-50">Практические уроки по программированию</p></li></ul></div></div></div>
    </section>
    </main>
    <footer class="footer border-top py-3 mt-5 bg-light"><div class="container-xl">
    <div class="text-center">created by <a href="https://ru.hexlet.io/professions/frontend/projects/11" target="_blank">Hexlet</a>
    </div></div></footer></body></html>










    import * as yup from 'yup';
import onChange from 'on-change';
import render from './render.js';
import validate from './validate.js'


const validationSchema = yup
  .string()
  .url('Введите правильный URL')
  .required('URL обязателен для заполнения');

const items =  {
  input: document.querySelector('#url-input'),
  feedback: document.querySelector('.feedback'),
  example: document.querySelector('p > .mt-2 mb-0'),
  container: document.querySelector('.container-xxl'),
  post: {
    links: [],
    titles: [],
  }
}
  

const parser = (data) => {
  const xmlText = data.contents;
  const parser = new DOMParser();
  const xmlDoc = parser.parseFromString(xmlText, 'application/xml');


  const titles = xmlDoc.getElementsByTagName('title');
  const links = xmlDoc.getElementsByTagName('link');
  
  for (const title of titles) {
    items.post.titles.push(title);
 }
 
 for (const link of links) {
    items.post.links.push(link);
 }
//  console.log(items.post)
}


export default async () => {

  const state = {
    isValid: null,
    feed: new Set(),
  };
  
  const watchedState = onChange(state, () => {
    // if (watchedState.someFlag) {
      render(watchedState, items);
    // }
  });
  
  const form = document.querySelector('form');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const url =  items.input.value;

    await validate(url, watchedState, validationSchema);

    await fetch(`https://allorigins.hexlet.app/get?url=${encodeURIComponent('https://ru.hexlet.io/lessons.rss')}`)
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok.');
        }
        console.log(response)
        return response.json(); // Получаем JSON
      })
      .then(data => {
        // console.log(data)
        parser(data);
        // Устанавливаем флаг, чтобы сигнализировать об окончании парсинга
        watchedState.someFlag = true;
      })
      .catch(error => {
        console.error('Error:', error);
        // В случае ошибки тоже устанавливаем флаг, чтобы избежать блокировки
        watchedState.someFlag = true;
      });
  });

  
};
  